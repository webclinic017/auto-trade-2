version: '3'
services:
  clickhouse:
    image: yandex/clickhouse-server:21.12.3.32
    container_name: clickhouse_1
    hostname: clickhouse_1
    environment:
      # - TZ: "Asia/Shanghai"
      - ALLOW_EMPTY_PASSWORD=no
    volumes:
      # - ./config.xml:/etc/clickhouse-server/config.xml
      # - ./users.xml:/etc/clickhouse-server/users.xml
      # - ./log/clickhouse-server.log:/var/log/clickhouse-server/clickhouse-server.log
      # - ./log/clickhouse-server.err.log:/var/log/clickhouse-server/clickhouse-server.err.log
      - clickhouse:/var/lib/clickhouse
    ulimits:
      nofile:
        soft: 262144
        hard: 262144
    ports:
      - "8123:8123"
      # - "9000:9000"
      # - "9004:9004"
    # expose：暴露端口，但不映射到宿主机，所以外部无法访问该端口，仅能容器内部访问使用
    # expose:
    #   - 9009
    networks:
      - postgres
    restart: unless-stopped

  # clickhouse-client:
  #   image: yandex/clickhouse-client:21.12.3.32
  #   entrypoint:
  #     - /bin/sleep
  #   command:
  #     - infinity
  #   networks:
  #     - postgres
  #   restart: unless-stopped

networks:
  postgres:
    driver: bridge
    # ipam:
    #   config:
    #     - subnet: 10.222.1.0/24

volumes:
  clickhouse:
